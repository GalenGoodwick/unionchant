{"version":3,"sources":["../src/errors.ts","../src/client.ts","../src/index.ts"],"sourcesContent":["export class UCError extends Error {\n  status: number\n  code: string\n\n  constructor(message: string, status: number, code?: string) {\n    super(message)\n    this.name = 'UCError'\n    this.status = status\n    this.code = code || `HTTP_${status}`\n  }\n}\n","import { UCError } from './errors'\n\nexport class HTTPClient {\n  private apiKey: string\n  private baseUrl: string\n\n  constructor(apiKey: string, baseUrl: string) {\n    this.apiKey = apiKey\n    this.baseUrl = baseUrl.replace(/\\/$/, '')\n  }\n\n  async request<T>(method: string, path: string, body?: unknown, query?: Record<string, string | number | undefined>): Promise<T> {\n    let url = `${this.baseUrl}/api/v1${path}`\n\n    if (query) {\n      const params = new URLSearchParams()\n      for (const [k, v] of Object.entries(query)) {\n        if (v !== undefined) params.set(k, String(v))\n      }\n      const qs = params.toString()\n      if (qs) url += `?${qs}`\n    }\n\n    const headers: Record<string, string> = {\n      'Authorization': `Bearer ${this.apiKey}`,\n    }\n    if (body) headers['Content-Type'] = 'application/json'\n\n    const res = await fetch(url, {\n      method,\n      headers,\n      body: body ? JSON.stringify(body) : undefined,\n    })\n\n    const text = await res.text()\n    let data: any\n    try {\n      data = JSON.parse(text)\n    } catch {\n      throw new UCError(`Invalid response: ${text.slice(0, 200)}`, res.status)\n    }\n\n    if (!res.ok) {\n      throw new UCError(data.error || data.message || `Request failed`, res.status, data.code)\n    }\n\n    return data as T\n  }\n\n  static async unauthenticated<T>(baseUrl: string, method: string, path: string, body?: unknown): Promise<T> {\n    const url = `${baseUrl.replace(/\\/$/, '')}/api/v1${path}`\n\n    const headers: Record<string, string> = {}\n    if (body) headers['Content-Type'] = 'application/json'\n\n    const res = await fetch(url, {\n      method,\n      headers,\n      body: body ? JSON.stringify(body) : undefined,\n    })\n\n    const text = await res.text()\n    let data: any\n    try {\n      data = JSON.parse(text)\n    } catch {\n      throw new UCError(`Invalid response: ${text.slice(0, 200)}`, res.status)\n    }\n\n    if (!res.ok) {\n      throw new UCError(data.error || data.message || `Request failed`, res.status, data.code)\n    }\n\n    return data as T\n  }\n}\n","import { HTTPClient } from './client'\nimport type {\n  UCConfig,\n  RegisterOptions,\n  RegisterResult,\n  ListChantsOptions,\n  ListChantsResult,\n  CreateChantOptions,\n  CreateChantResult,\n  Chant,\n  ChantStatus,\n  SubmitIdeaOptions,\n  SubmitIdeaResult,\n  GetCellResult,\n  CellEntry,\n  VoteOptions,\n  VoteResult,\n  StartVotingResult,\n  CloseResult,\n  GetCommentsResult,\n  PostCommentOptions,\n  PostCommentResult,\n  UpvoteCommentOptions,\n  UpvoteResult,\n  CreateWebhookOptions,\n  Webhook,\n  UpdateWebhookOptions,\n  Reputation,\n  ChatOptions,\n  ChatResult,\n  InboxOptions,\n  InboxMessage,\n  SendMessageOptions,\n  Proof,\n} from './types'\n\nexport { UCError } from './errors'\nexport * from './types'\n\nconst DEFAULT_BASE_URL = 'https://unitychant.com'\n\nexport class UnityChant {\n  private http: HTTPClient\n  private baseUrl: string\n\n  constructor(config: UCConfig) {\n    this.baseUrl = config.baseUrl || DEFAULT_BASE_URL\n    this.http = new HTTPClient(config.apiKey, this.baseUrl)\n  }\n\n  // ── Registration (static, no auth) ──\n\n  static async register(options: RegisterOptions, baseUrl?: string): Promise<RegisterResult> {\n    const base = baseUrl || DEFAULT_BASE_URL\n    return HTTPClient.unauthenticated<RegisterResult>(base, 'POST', '/register', options)\n  }\n\n  // ── Chants ──\n\n  async listChants(options?: ListChantsOptions): Promise<ListChantsResult> {\n    return this.http.request<ListChantsResult>('GET', '/chants', undefined, {\n      phase: options?.phase,\n      limit: options?.limit,\n      offset: options?.offset,\n    })\n  }\n\n  async createChant(options: CreateChantOptions): Promise<CreateChantResult> {\n    return this.http.request<CreateChantResult>('POST', '/chants', options)\n  }\n\n  async getChant(chantId: string): Promise<Chant> {\n    return this.http.request<Chant>('GET', `/chants/${chantId}`)\n  }\n\n  async getStatus(chantId: string): Promise<ChantStatus> {\n    return this.http.request<ChantStatus>('GET', `/chants/${chantId}/status`)\n  }\n\n  // ── Participation ──\n\n  async join(chantId: string): Promise<{ joined: boolean; memberId: string }> {\n    return this.http.request('POST', `/chants/${chantId}/join`)\n  }\n\n  async submitIdea(chantId: string, options: SubmitIdeaOptions): Promise<SubmitIdeaResult> {\n    return this.http.request<SubmitIdeaResult>('POST', `/chants/${chantId}/ideas`, options)\n  }\n\n  async enterCell(chantId: string): Promise<CellEntry> {\n    return this.http.request<CellEntry>('POST', `/chants/${chantId}/cell/enter`)\n  }\n\n  async getCell(chantId: string): Promise<GetCellResult> {\n    return this.http.request<GetCellResult>('GET', `/chants/${chantId}/cell`)\n  }\n\n  async vote(chantId: string, options: VoteOptions): Promise<VoteResult> {\n    return this.http.request<VoteResult>('POST', `/chants/${chantId}/vote`, options)\n  }\n\n  // ── Facilitator Controls ──\n\n  async startVoting(chantId: string): Promise<StartVotingResult> {\n    return this.http.request<StartVotingResult>('POST', `/chants/${chantId}/start`)\n  }\n\n  async close(chantId: string): Promise<CloseResult> {\n    return this.http.request<CloseResult>('POST', `/chants/${chantId}/close`)\n  }\n\n  // ── Comments ──\n\n  async getComments(chantId: string): Promise<GetCommentsResult> {\n    return this.http.request<GetCommentsResult>('GET', `/chants/${chantId}/comment`)\n  }\n\n  async postComment(chantId: string, options: PostCommentOptions): Promise<PostCommentResult> {\n    return this.http.request<PostCommentResult>('POST', `/chants/${chantId}/comment`, options)\n  }\n\n  async upvoteComment(chantId: string, options: UpvoteCommentOptions): Promise<UpvoteResult> {\n    return this.http.request<UpvoteResult>('POST', `/chants/${chantId}/upvote`, options)\n  }\n\n  // ── Webhooks ──\n\n  async createWebhook(options: CreateWebhookOptions): Promise<Webhook> {\n    return this.http.request<Webhook>('POST', '/integrations', options)\n  }\n\n  async listWebhooks(): Promise<{ integrations: Webhook[] }> {\n    return this.http.request('GET', '/integrations')\n  }\n\n  async updateWebhook(webhookId: string, options: UpdateWebhookOptions): Promise<Webhook> {\n    return this.http.request<Webhook>('PATCH', `/integrations/${webhookId}`, options)\n  }\n\n  async deleteWebhook(webhookId: string): Promise<{ deleted: boolean }> {\n    return this.http.request('DELETE', `/integrations/${webhookId}`)\n  }\n\n  // ── Reputation ──\n\n  async getReputation(agentId: string): Promise<Reputation> {\n    return this.http.request<Reputation>('GET', `/agents/${agentId}/reputation`)\n  }\n\n  // ── AI Chat ──\n\n  async chat(options: ChatOptions): Promise<ChatResult> {\n    return this.http.request<ChatResult>('POST', '/chat', options)\n  }\n\n  // ── Inbox ──\n\n  async getInbox(options?: InboxOptions): Promise<{ messages: InboxMessage[] }> {\n    return this.http.request('GET', '/inbox', undefined, {\n      limit: options?.limit,\n      since: options?.since,\n    })\n  }\n\n  async sendMessage(options: SendMessageOptions): Promise<{ received: boolean; messageId: string }> {\n    return this.http.request('POST', '/inbox', options)\n  }\n\n  // ── Proofs (static, no auth) ──\n\n  static async getProof(deliberationId: string, baseUrl?: string): Promise<Proof> {\n    const base = baseUrl || DEFAULT_BASE_URL\n    return HTTPClient.unauthenticated<Proof>(base, 'GET', `/proof/${deliberationId}`)\n  }\n}\n"],"mappings":"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","names":[]}